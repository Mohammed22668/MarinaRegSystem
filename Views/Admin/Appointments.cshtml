@* @model IEnumerable<MarinaRegSystem.Models.Appointment> *@
@model MarinaRegSystem.Models.AppointmentFilterViewModel
@using MarinaRegSystem.Helpers
@using Microsoft.AspNetCore.Mvc.Rendering
@{
    Layout = "_LayoutAdmin";
    ViewData["Title"] = "Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª";
}



@section Head {

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
        <link rel="shortcut icon" href="~/assets/img/favicon.png">
        <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† - Ù…Ø³ØªØ´ÙÙ‰ Ù…Ø§Ø±ÙŠÙ†Ø§</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" type="text/css" href="~/assets/css/bootstrap.rtl.min.css">

        <!-- Fontawesome CSS -->
        <link rel="stylesheet" href="~/assets/plugins/fontawesome/css/fontawesome.min.css">
        <link rel="stylesheet" href="~/assets/plugins/fontawesome/css/all.min.css">

        <!-- Select2 CSS -->
        <link rel="stylesheet" type="text/css" href="~/assets/css/select2.min.css">

        <!-- Datatables CSS -->
        <link rel="stylesheet" href="~/assets/plugins/datatables/datatables.min.css">

        <!-- Feathericon CSS -->
        <link rel="stylesheet" href="~/assets/css/feather.css">

        <!-- Main CSS -->
        <link rel="stylesheet" type="text/css" href="~/assets/css/style.css">

        <!-- Animate -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />


        <style>
            .table th {
                background-color: #f1f4f7;
                color: #3b3f5c;
                font-weight: bold;
                text-align: center;
                vertical-align: middle;
            }

            .table td {
                text-align: center;
                vertical-align: middle;
            }

            .table-avatar a {
                display: flex;
                align-items: center;
                gap: 10px;
                text-decoration: none;
            }

            .table-avatar img {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
            }

            .rating i {
                font-size: 1rem;
            }

            .actions .btn {
                padding: 5px 10px;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .bg-success-light {
                background-color: #d4edda;
                color: #155724;
            }

            .bg-danger-light {
                background-color: #f8d7da;
                color: #721c24;
            }

            .btn-primary i {
                margin-left: 5px;
            }

            .page-title {
                font-weight: 700;
                color: #3b3f5c;
                font-size: 1.75rem;
            }

            .badge {
                font-size: 0.85rem;
                padding: 6px 12px;
                border-radius: 50px;
            }
        </style>

    </head>
}

@section currentPage {
    <li class="menu-side"><img src="~/assets/img/icons/menu-icon-04.svg" alt=""></li>
    <li class="breadcrumb-item" style="margin-right:10px"><a href="#" style="font-weight:bolder">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª </a></li>
}





<!-- ğŸ” Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø© -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h5 class="card-title mb-4 text-primary">
            <i class="fas fa-filter me-2"></i> ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
        </h5>

        <form method="get" asp-action="Appointments">
            <div class="row g-3">
                <div class="col-md-4 col-lg-3">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
                    <input type="text" name="PatientName" value="@Model.PatientName" class="form-control"
                        placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶" />
                </div>

                <div class="col-md-4 col-lg-3">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
                    <input type="text" name="DoctorName" value="@Model.DoctorName" class="form-control"
                        placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨" />
                </div>

                <div class="col-md-4 col-lg-3">
                    <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select name="DepartmentId" class="form-select">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>
                        @foreach (var dept in Model.Departments)
                        {
                            <option value="@dept.Value" selected="@(dept.Value == Model.DepartmentId?.ToString())">
                                @dept.Text</option>
                        }
                    </select>
                </div>

                <div class="col-md-6 col-lg-3">
                    <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select name="Status" class="form-select">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© --</option>
                        @foreach (var item in EnumExtensions.ToSelectList<MarinaRegSystem.Models.AppointmentStatus>())
                        {
                            <option value="@item.Value" selected="@(item.Value == Model.Status?.ToString())">@item.Text
                            </option>
                        }
                    </select>
                </div>

                <div class="col-md-6 col-lg-3">
                    <label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" name="FromDate" value="@(Model.FromDate?.ToString("yyyy-MM-dd"))"
                        class="form-control" />
                </div>

                <div class="col-md-6 col-lg-3">
                    <label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" name="ToDate" value="@(Model.ToDate?.ToString("yyyy-MM-dd"))"
                        class="form-control" />
                </div>

                <div class="col-md-6 col-lg-3 d-grid align-self-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-1"></i> Ø¨Ø­Ø«
                    </button>
                </div>

                <div class="col-md-6 col-lg-3 d-grid align-self-end">
                    <button type="submit" name="export" value="excel" class="btn btn-success">
                        <i class="fas fa-file-excel me-1"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª -->
<ul class="nav nav-pills nav-justified mb-4 bg-light p-1 rounded shadow-sm" id="appointmentTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active rounded-pill" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming"
            type="button" role="tab">
            <i class="fas fa-calendar-check me-1"></i> Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© / Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link rounded-pill" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button"
            role="tab">
            <i class="fas fa-history me-1"></i> Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        </button>
    </li>
</ul>
<div class="tab-content" id="appointmentTabsContent">
    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
    <div class="tab-pane fade show active" id="upcoming" role="tabpanel">
        @await Html.PartialAsync("_AppointmentsTable", Model.Results.Where(r => r.Appointment.Status ==
        AppointmentStatus.Pending || r.Appointment.Status == AppointmentStatus.Confirmed).OrderByDescending(r =>
        r.Appointment.AppointmentDate).ThenByDescending(r => r.Appointment.AppointmentTime).ToList())
    </div>

    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
    <div class="tab-pane fade" id="past" role="tabpanel">
        @await Html.PartialAsync("_AppointmentsTable", Model.Results.Where(r => r.Appointment.Status !=
                AppointmentStatus.Pending && r.Appointment.Status != AppointmentStatus.Confirmed).OrderByDescending(r =>
                r.Appointment.AppointmentDate).ThenByDescending(r => r.Appointment.AppointmentTime).ToList())
    </div>
</div>



@section Scripts {

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const deleteButtons = document.querySelectorAll('.btn-delete');

            deleteButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const appointmentId = this.getAttribute('data-id');

                    Swal.fire({
                        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                        text: "Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø°Ù!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù!',
                        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„ÙÙˆØ±Ù… Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡
                            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£Ø³Ù‡Ù„: Ø¹Ù…Ù„ ÙÙˆØ±Ù… ÙˆØ­Ø°Ù Ø¨Ø±Ù…Ø¬ÙŠ

                            // Ø¥Ù†Ø´Ø§Ø¡ ÙÙˆØ±Ù… Ù…Ø¤Ù‚Øª Ù„Ù„Ø­Ø°Ù (POST)
                            const form = document.createElement('form');
                            form.method = 'post';
                            form.action = `/Admin/DeleteAppointment/${appointmentId}`;

                            // Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª CSRF (Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ³ØªØ®Ø¯Ù…Ù‡)
                            const token = document.querySelector('input[name="__RequestVerificationToken"]');
                            if (token) {
                                const hiddenInput = document.createElement('input');
                                hiddenInput.type = 'hidden';
                                hiddenInput.name = '__RequestVerificationToken';
                                hiddenInput.value = token.value;
                                form.appendChild(hiddenInput);
                            }

                            document.body.appendChild(form);
                            form.submit();
                        }
                    });
                });
            });
        });
    </script>


}



@section Footer {
    <!-- jQuery -->
    <script src="~/assets/js/jquery-3.7.1.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="~/assets/js/bootstrap.bundle.min.js"></script>

    <!-- Feather Js -->
    <script src="~/assets/js/feather.min.js"></script>

    <!-- Slimscroll -->
    <script src="~/assets/js/jquery.slimscroll.js"></script>

    <!-- Select2 Js -->
    <script src="~/assets/js/select2.min.js"></script>

    <!-- Datepicker JS -->
    <script src="~/assets/plugins/moment/moment.min.js"></script>
    <script src="~/assets/js/bootstrap-datetimepicker.min.js"></script>

    <!-- Custom JS -->
    <script src="~/assets/js/script.js"></script>

    <!-- Validation Scripts -->
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
}